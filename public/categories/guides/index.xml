<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Guides on The Patch Panel</title>
        <link>http://192.168.100.63:1313/categories/guides/</link>
        <description>Recent content in Guides on The Patch Panel</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Mon, 07 Oct 2024 10:45:00 -0400</lastBuildDate><atom:link href="http://192.168.100.63:1313/categories/guides/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Building a Production-Ready Nextcloud Setup: From LXC to AI Integration</title>
        <link>http://192.168.100.63:1313/projects/nextcloud/</link>
        <pubDate>Mon, 07 Oct 2024 10:45:00 -0400</pubDate>
        
        <guid>http://192.168.100.63:1313/projects/nextcloud/</guid>
        <description>&lt;img src="http://192.168.100.63:1313/img/head/Nextcloud.png" alt="Featured image of post Building a Production-Ready Nextcloud Setup: From LXC to AI Integration" /&gt;&lt;h3 id=&#34;ai-summary&#34;&gt;&lt;a href=&#34;#ai-summary&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;AI Summary
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Split Nextcloud architecture across multiple containers for better performance and scalability&lt;/li&gt;
&lt;li&gt;Use PostgreSQL over SQLite/MySQL for better concurrent handling and JSON performance&lt;/li&gt;
&lt;li&gt;Implement proper caching with Redis and APCu to dramatically improve response times&lt;/li&gt;
&lt;li&gt;Integrate with AI document processing pipeline using Paperless-NGX and local LLM infrastructure&lt;/li&gt;
&lt;li&gt;Navigate LXC permission mapping and storage mounting for reliable operation&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;the-problem-with-most-nextcloud-setups&#34;&gt;&lt;a href=&#34;#the-problem-with-most-nextcloud-setups&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Problem with Most Nextcloud Setups
&lt;/h3&gt;&lt;p&gt;After running a janky Nextcloud install for way too long, I finally sat down to build something that wouldn&amp;rsquo;t embarrass me when sharing files. Most guides throw everything on one machine, use SQLite, and wonder why performance is terrible.&lt;/p&gt;
&lt;p&gt;Time for a complete rebuild - one that would scale, perform well, and integrate with my broader AI document processing workflow.&lt;/p&gt;
&lt;h3 id=&#34;architecture-splitting-components-smart&#34;&gt;&lt;a href=&#34;#architecture-splitting-components-smart&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Architecture: Splitting Components Smart
&lt;/h3&gt;&lt;p&gt;The core insight was realizing that different components have completely different performance profiles. The Nextcloud application itself needs to be snappy for web requests. The database needs to handle concurrent operations without choking. But bulk file storage? A vacation video from three years ago doesn&amp;rsquo;t need NVMe speeds.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;My R430 Proxmox setup handles this with separation:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Nextcloud app lives on SSD&lt;/strong&gt; - Core application in LXC container on local storage for responsive UI&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PostgreSQL gets its own container&lt;/strong&gt; - Dedicated database server with proper resources&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bulk storage on the R730XD&lt;/strong&gt; - User files live on Unraid NAS via NFS mounts&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Caching layer in Redis&lt;/strong&gt; - File locking and performance optimization&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This approach gives me fast UI response times without breaking the bank on storage costs, while setting up integration points for my AI processing pipeline.&lt;/p&gt;
&lt;h3 id=&#34;the-lxc-foundation&#34;&gt;&lt;a href=&#34;#the-lxc-foundation&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The LXC Foundation
&lt;/h3&gt;&lt;p&gt;Instead of building everything from scratch, I started with the TurnKey Nextcloud template. It comes pre-configured with Apache, PHP, Redis, and security hardening - no point reinventing the wheel.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pct create &lt;span style=&#34;color:#ae81ff&#34;&gt;101&lt;/span&gt; local:vztmpl/turnkey-nextcloud-18.0-buster-amd64.tar.gz &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --storage local-zfs &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --hostname NextCloud &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --memory &lt;span style=&#34;color:#ae81ff&#34;&gt;8000&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --cores &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pct start &lt;span style=&#34;color:#ae81ff&#34;&gt;101&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I gave it 8GB RAM and 4 cores because Nextcloud actually benefits from having resources available for caching and concurrent operations. Storage performance matters more than most people realize.&lt;/p&gt;
&lt;h3 id=&#34;database-postgresql-over-everything&#34;&gt;&lt;a href=&#34;#database-postgresql-over-everything&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Database: PostgreSQL Over Everything
&lt;/h3&gt;&lt;p&gt;This is where most setups go wrong. SQLite is fine for testing, but if you want decent performance with multiple devices syncing, you need a proper database server.&lt;/p&gt;
&lt;p&gt;I went with PostgreSQL in its own LXC container for several reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Better concurrency handling&lt;/strong&gt; - MVCC system handles simultaneous file operations more gracefully&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Superior JSON performance&lt;/strong&gt; - Nextcloud stores tons of metadata, and PostgreSQL&amp;rsquo;s JSON operations are genuinely faster&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Personal reliability&lt;/strong&gt; - I&amp;rsquo;ve had fewer weird issues with PostgreSQL over the years&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Setting up the database server:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt install -y postgresql
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl enable --now postgresql
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo -u postgres psql
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CREATE DATABASE nextcloud;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CREATE USER nextclouduser WITH PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;your-secure-password&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ALTER DATABASE nextcloud OWNER TO nextclouduser;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\q&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;storage-strategy-nfs-integration-with-unraid&#34;&gt;&lt;a href=&#34;#storage-strategy-nfs-integration-with-unraid&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Storage Strategy: NFS Integration with Unraid
&lt;/h3&gt;&lt;p&gt;Here&amp;rsquo;s where the R730XD Unraid server comes into play. Instead of local storage eating up the Proxmox node, I mount NFS shares from the main NAS.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;On the Unraid side:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Create dedicated share for Nextcloud data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Export via NFS with proper permissions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Mounting in the LXC container:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Edit container config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nano /etc/pve/lxc/101.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Add NFS mount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mp0: /mnt/unraid-nextcloud,mp&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/mnt/nextcloud
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;the-permissions-dance-lxc-reality-check&#34;&gt;&lt;a href=&#34;#the-permissions-dance-lxc-reality-check&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Permissions Dance (LXC Reality Check)
&lt;/h3&gt;&lt;p&gt;This is where unprivileged LXC containers get annoying. The UIDs don&amp;rsquo;t match between host and container, so you have to manually map permissions.&lt;/p&gt;
&lt;p&gt;The magic numbers for unprivileged containers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Container UID 33 (www-data) maps to host UID 101033&lt;/li&gt;
&lt;li&gt;Container GID 33 (www-data) maps to host GID 101033&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# On Proxmox host&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chown -R 101033:101033 /mnt/unraid-nextcloud
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Verify the mapping worked&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ls -la /mnt/unraid-nextcloud/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This took me way too long to figure out the first time. The container starts, everything looks fine, then you get permission errors when Nextcloud tries to write files.&lt;/p&gt;
&lt;h3 id=&#34;performance-caching-is-not-optional&#34;&gt;&lt;a href=&#34;#performance-caching-is-not-optional&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Performance: Caching Is Not Optional
&lt;/h3&gt;&lt;p&gt;Default Nextcloud feels sluggish because it hits the database constantly. The solution is proper caching at multiple levels:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt install -y redis-server php-redis php-apcu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Configuration in &lt;code&gt;/var/www/nextcloud/config/config.php&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;memcache.local&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;\OC\Memcache\APCu&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;memcache.locking&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;\OC\Memcache\Redis&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;redis&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;host&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;port&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6379&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;timeout&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The difference is honestly dramatic. File operations that used to take 5-10 seconds now happen almost instantly. This is the pivot point where the whole system transforms from &amp;ldquo;usable&amp;rdquo; to &amp;ldquo;professional.&amp;rdquo;&lt;/p&gt;
&lt;h3 id=&#34;moving-data-and-final-configuration&#34;&gt;&lt;a href=&#34;#moving-data-and-final-configuration&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Moving Data and Final Configuration
&lt;/h3&gt;&lt;p&gt;With storage mounted and permissions sorted, time to migrate the data directory:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl stop apache2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rsync -av /var/www/nextcloud/data/ /mnt/nextcloud/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Update config.php&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;datadirectory&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/mnt/nextcloud&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Final LXC configuration:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;arch: amd64
cores: 4
features: nesting=1
hostname: NextCloud
memory: 8000
mp0: /mnt/unraid-nextcloud,mp=/mnt/nextcloud
net0: name=eth0,bridge=vmbr0,firewall=1,ip=192.168.1.100/24,type=veth
ostype: debian
rootfs: local-zfs:subvol-101-disk-0,size=8G
swap: 8000
unprivileged: 1
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;verification-and-optimization&#34;&gt;&lt;a href=&#34;#verification-and-optimization&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Verification and Optimization
&lt;/h3&gt;&lt;p&gt;After setup, verify everything is working properly:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Check status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;su - www-data -s /bin/bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;php /var/www/nextcloud/occ status&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Scan for missing files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;su - www-data -s /bin/bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;php /var/www/nextcloud/occ files:scan --all&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Add missing database indices (crucial for performance)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;su - www-data -s /bin/bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;php /var/www/nextcloud/occ db:add-missing-indices&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That last command is critical - Nextcloud sometimes misses database indices during setup, and they make a huge difference for query performance.&lt;/p&gt;
&lt;h3 id=&#34;integration-with-ai-document-processing-pipeline&#34;&gt;&lt;a href=&#34;#integration-with-ai-document-processing-pipeline&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Integration with AI Document Processing Pipeline
&lt;/h3&gt;&lt;p&gt;This is where things get interesting. The Nextcloud setup I just described isn&amp;rsquo;t just file storage - it&amp;rsquo;s part of a larger AI-powered document processing workflow.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The broader architecture includes:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Dual RTX 3090 AI box&lt;/strong&gt; running &lt;code&gt;llama.cpp&lt;/code&gt; for local LLM inference&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Paperless-NGX&lt;/strong&gt; for document OCR and metadata extraction&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Vector databases&lt;/strong&gt; on the R430 for RAG pipelines&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LibreChat&lt;/strong&gt; as frontend for AI interactions&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;document-processing-workflow&#34;&gt;&lt;a href=&#34;#document-processing-workflow&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Document Processing Workflow
&lt;/h3&gt;&lt;p&gt;Documents flow through this pipeline:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Upload to Nextcloud&lt;/strong&gt; - Files arrive via web interface or sync clients&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Auto-detection&lt;/strong&gt; - Paperless-NGX monitors Nextcloud directories via inotify&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OCR Processing&lt;/strong&gt; - Documents get OCR&amp;rsquo;d and full-text indexed&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AI Metadata Extraction&lt;/strong&gt; - Local LLMs extract structured metadata, tags, and summaries&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Storage Integration&lt;/strong&gt; - Processed documents return to Nextcloud with enriched metadata&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The technical implementation uses shared storage between containers:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Paperless-NGX container mounts same NFS shares&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Shared directory structure:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/mnt/nextcloud/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── documents/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── incoming/     &lt;span style=&#34;color:#75715e&#34;&gt;# Paperless monitors this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── processed/    &lt;span style=&#34;color:#75715e&#34;&gt;# AI-enriched documents&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── archive/      &lt;span style=&#34;color:#75715e&#34;&gt;# Long-term storage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ai-processing-configuration&#34;&gt;&lt;a href=&#34;#ai-processing-configuration&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;AI Processing Configuration
&lt;/h3&gt;&lt;p&gt;The LLM inference happens on the dual RTX 3090 box, with models accessed via API:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Example AI metadata extraction&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; requests
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;extract_metadata&lt;/span&gt;(document_path):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    payload &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;llama-3.1-8b&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;prompt&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Extract key metadata from: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;document_text&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;max_tokens&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; requests&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;post(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://ai-box:8080/v1/completions&amp;#34;&lt;/span&gt;, json&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;payload)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; response&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;json()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The extracted metadata gets written back to Nextcloud as extended attributes and indexed for search.&lt;/p&gt;
&lt;h3 id=&#34;vector-database-integration&#34;&gt;&lt;a href=&#34;#vector-database-integration&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Vector Database Integration
&lt;/h3&gt;&lt;p&gt;For RAG capabilities, documents get embedded and stored in a vector database running on the R430:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Document embedding pipeline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; sentence_transformers &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; SentenceTransformer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; qdrant_client
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SentenceTransformer(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;all-MiniLM-L6-v2&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;client &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; qdrant_client&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;QdrantClient(host&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;r430-vector-db&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;embed_document&lt;/span&gt;(doc_text, doc_id):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    embedding &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode(doc_text)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    client&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upsert(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        collection_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;documents&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        points&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: doc_id,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;vector&amp;#34;&lt;/span&gt;: embedding&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tolist(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;payload&amp;#34;&lt;/span&gt;: {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;: doc_text, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nextcloud_path&amp;#34;&lt;/span&gt;: doc_path}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This enables semantic search across all documents via LibreChat or custom interfaces.&lt;/p&gt;
&lt;h3 id=&#34;network-integration-and-security&#34;&gt;&lt;a href=&#34;#network-integration-and-security&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Network Integration and Security
&lt;/h3&gt;&lt;p&gt;The whole setup operates within my VLAN-segmented network:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Work VLAN&lt;/strong&gt; - Nextcloud accessible from work devices&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Personal VLAN&lt;/strong&gt; - Home devices and mobile sync&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Dirty/Test VLAN&lt;/strong&gt; - AI processing and development work&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DMZ&lt;/strong&gt; - External access via Cloudflare tunnels&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Traffic routing through OPNsense with proper firewall rules between VLANs. The Brocade ICX6450 handles Layer 2 switching with 10GbE uplinks between critical services.&lt;/p&gt;
&lt;h3 id=&#34;backup-strategy&#34;&gt;&lt;a href=&#34;#backup-strategy&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Backup Strategy
&lt;/h3&gt;&lt;p&gt;With this much integration, backup becomes critical:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Automated backup script&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rsync -av /mnt/nextcloud/ /mnt/r730-backup/nextcloud/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pg_dump -h postgres-server nextcloud | gzip &amp;gt; /mnt/r730-backup/nextcloud-db-&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;date +%Y%m%d&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;.sql.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Vector database backup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker exec qdrant-container /qdrant/backup.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kopia handles the actual backup execution with custom repository paths across the infrastructure.&lt;/p&gt;
&lt;h3 id=&#34;performance-results&#34;&gt;&lt;a href=&#34;#performance-results&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Performance Results
&lt;/h3&gt;&lt;p&gt;After several months of operation, the numbers speak for themselves:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Web interface response&lt;/strong&gt; - Sub-second page loads&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;File sync performance&lt;/strong&gt; - 50MB+ files transfer smoothly&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Concurrent users&lt;/strong&gt; - Multiple devices syncing without conflicts&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AI processing&lt;/strong&gt; - Documents processed and metadata extracted within minutes of upload&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Search performance&lt;/strong&gt; - Semantic search across 10k+ documents in under 200ms&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;what-id-change&#34;&gt;&lt;a href=&#34;#what-id-change&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;What I&amp;rsquo;d Change
&lt;/h3&gt;&lt;p&gt;If I were starting over, a few things I&amp;rsquo;d do differently:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Database clustering&lt;/strong&gt; - PostgreSQL works great, but for redundancy I&amp;rsquo;d set up a primary/replica configuration across multiple LXC containers.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Dedicated AI processing queue&lt;/strong&gt; - Instead of direct monitoring, I&amp;rsquo;d implement a proper job queue (Redis/Celery) for document processing tasks.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Object storage backend&lt;/strong&gt; - Consider MinIO or similar for the bulk storage layer instead of NFS mounts.&lt;/p&gt;
&lt;h3 id=&#34;the-bigger-picture&#34;&gt;&lt;a href=&#34;#the-bigger-picture&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Bigger Picture
&lt;/h3&gt;&lt;p&gt;This isn&amp;rsquo;t just about running Nextcloud - it&amp;rsquo;s about building a foundation for AI-augmented personal data management. The combination of reliable file storage, local AI processing, and semantic search creates something genuinely useful.&lt;/p&gt;
&lt;p&gt;The technical complexity is higher than a basic Nextcloud install, but the capabilities justify the effort. When you can upload a document and immediately search across all your files using natural language queries, or have AI automatically tag and categorize everything - that&amp;rsquo;s when self-hosting becomes genuinely superior to commercial alternatives.&lt;/p&gt;
&lt;p&gt;My hope is that this provides a new lens for your own infrastructure projects. The conversation doesn&amp;rsquo;t end here - I&amp;rsquo;m keen to hear how others are integrating AI capabilities into their self-hosted setups.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Getting My Blog Actually Working: Hugo &#43; Gitea &#43; GitHub &#43; Cloudflare Pages</title>
        <link>http://192.168.100.63:1313/projects/hugo-blog-setup/</link>
        <pubDate>Mon, 30 Sep 2024 14:30:00 -0400</pubDate>
        
        <guid>http://192.168.100.63:1313/projects/hugo-blog-setup/</guid>
        <description>&lt;img src="http://192.168.100.63:1313/img/head/hugo.png" alt="Featured image of post Getting My Blog Actually Working: Hugo &#43; Gitea &#43; GitHub &#43; Cloudflare Pages" /&gt;&lt;h3 id=&#34;ai-summary&#34;&gt;&lt;a href=&#34;#ai-summary&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;AI Summary
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Setting up Hugo with Gitea, GitHub, and Cloudflare Pages turned into a multi-hour debugging adventure&lt;/li&gt;
&lt;li&gt;Git submodules are finicky - sometimes nuking and starting over is faster than fixing broken states&lt;/li&gt;
&lt;li&gt;Version pinning matters for Hugo builds on Cloudflare Pages (add a package.json with Hugo version)&lt;/li&gt;
&lt;li&gt;The final workflow is actually clean: write in markdown, commit to Git, automatic deployment&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;the-itch-finally-got-scratched&#34;&gt;&lt;a href=&#34;#the-itch-finally-got-scratched&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Itch Finally Got Scratched
&lt;/h3&gt;&lt;p&gt;So I finally got tired of not having a proper blog. You know that feeling - thoughts pile up, insights accumulate, little discoveries happen in your homelab, and you keep thinking &amp;ldquo;I should write this down somewhere people might actually find it useful.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;But then you hit the eternal question: &lt;em&gt;where do I even host this thing?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;d been running other services in my homelab, so naturally I wanted to keep control of my content while still making it easy to publish. After way too much research and a few spectacular false starts, I ended up with Hugo feeding into what turned out to be a pretty elegant deployment pipeline.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how it all came together - including the parts where I wanted to throw my laptop out the window.&lt;/p&gt;
&lt;h3 id=&#34;why-hugo-made-sense&#34;&gt;&lt;a href=&#34;#why-hugo-made-sense&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Why Hugo Made Sense
&lt;/h3&gt;&lt;p&gt;Speed and simplicity won me over. I&amp;rsquo;ve dealt with WordPress before, and while it&amp;rsquo;s undeniably powerful, I really didn&amp;rsquo;t want to babysit another database or worry about security updates for a CMS that&amp;rsquo;s probably overkill for what I need.&lt;/p&gt;
&lt;p&gt;Hugo just takes markdown files and spits out a static site that loads insanely fast. The whole &lt;em&gt;write in markdown, commit to git, site updates automatically&lt;/em&gt; workflow appealed to the developer side of my brain. No admin panels, no databases, just files and version control.&lt;/p&gt;
&lt;p&gt;Sometimes the simplest path is the right path.&lt;/p&gt;
&lt;h3 id=&#34;the-setup-that-got-complicated-fast&#34;&gt;&lt;a href=&#34;#the-setup-that-got-complicated-fast&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Setup That Got Complicated Fast
&lt;/h3&gt;&lt;p&gt;My plan seemed reasonable enough:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Keep the main repo in my internal Gitea instance (because I like having control)&lt;/li&gt;
&lt;li&gt;Mirror it to GitHub (because that&amp;rsquo;s what Cloudflare Pages wants to see)&lt;/li&gt;
&lt;li&gt;Let Cloudflare handle the building and hosting (because why reinvent that wheel)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Simple, right?&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Narrator: It was not simple.&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;getting-hugo-running-the-easy-part&#34;&gt;&lt;a href=&#34;#getting-hugo-running-the-easy-part&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Getting Hugo Running (The Easy Part)
&lt;/h3&gt;&lt;p&gt;The basic setup was actually painless. On my server:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt install hugo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hugo new site myblog
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;So far so good. Then I needed a theme, and that&amp;rsquo;s where things got interesting in all the wrong ways.&lt;/p&gt;
&lt;h3 id=&#34;the-great-submodule-adventure&#34;&gt;&lt;a href=&#34;#the-great-submodule-adventure&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Great Submodule Adventure
&lt;/h3&gt;&lt;p&gt;Hugo themes are typically managed as Git submodules, which sounds elegant in theory. In practice? Well, let me tell you about my afternoon of increasingly creative swearing.&lt;/p&gt;
&lt;p&gt;I found a theme I liked (hugo-theme-stack) and added it the &amp;ldquo;normal&amp;rdquo; way:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule add https://github.com/CaiJimmy/hugo-theme-stack.git themes/stack
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Worked perfectly locally. Hugo was happy, the site looked good, everything was great. Then I pushed to GitHub and tried to deploy with Cloudflare Pages.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fatal: No url found for submodule path &amp;#39;themes/stack&amp;#39; in .gitmodules
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Great. Just great.&lt;/p&gt;
&lt;h3 id=&#34;down-the-rabbit-hole&#34;&gt;&lt;a href=&#34;#down-the-rabbit-hole&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Down the Rabbit Hole
&lt;/h3&gt;&lt;p&gt;This is where I spent way too much time trying different variations of &lt;code&gt;git rm --cached&lt;/code&gt; and &lt;code&gt;git submodule deinit&lt;/code&gt; and generally making things worse. Turns out GitHub was getting confused about the submodule reference, and Cloudflare couldn&amp;rsquo;t clone the theme during builds.&lt;/p&gt;
&lt;p&gt;I probably could have saved myself two hours by just reading the error message more carefully, but sometimes I prefer the reckless abandon approach to debugging.&lt;/p&gt;
&lt;h3 id=&#34;the-nuclear-option-which-actually-worked&#34;&gt;&lt;a href=&#34;#the-nuclear-option-which-actually-worked&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Nuclear Option (Which Actually Worked)
&lt;/h3&gt;&lt;p&gt;Eventually I just nuked the whole thing and started over:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Burn it all down&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule deinit -f themes/stack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git rm --cached themes/stack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm -rf .git/modules/themes/stack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm -rf themes/stack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Start fresh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule add https://github.com/CaiJimmy/hugo-theme-stack.git themes/stack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule update --init --recursive
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git commit -m &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Re-added Stack theme as a proper submodule&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git push origin main
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This time it actually worked. Sometimes the nuclear option genuinely is the right option.&lt;/p&gt;
&lt;h3 id=&#34;getting-cloudflare-pages-to-cooperate&#34;&gt;&lt;a href=&#34;#getting-cloudflare-pages-to-cooperate&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Getting Cloudflare Pages to Cooperate
&lt;/h3&gt;&lt;p&gt;With the submodule situation sorted, setting up Cloudflare Pages should have been straightforward.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Should have been.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I connected my GitHub repo to Cloudflare and set the build command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule update --init --recursive &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; hugo --gc --minify
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;First build attempt: failed. The error was something about field evaluation, which led me down another fun debugging path.&lt;/p&gt;
&lt;h3 id=&#34;the-hugo-version-problem&#34;&gt;&lt;a href=&#34;#the-hugo-version-problem&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;The Hugo Version Problem
&lt;/h3&gt;&lt;p&gt;Turns out Cloudflare Pages was running some ancient version of Hugo by default. My theme needed newer features, so I was getting errors like:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;can&amp;#39;t evaluate field Lastmod in type page.Site
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The fix was adding a &lt;code&gt;package.json&lt;/code&gt; file to specify the Hugo version:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;engines&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;hugo&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.118.2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Why this isn&amp;rsquo;t documented more prominently, I have no idea. But once I added that, builds started working.&lt;/p&gt;
&lt;h3 id=&#34;custom-domain-setup-finally-something-easy&#34;&gt;&lt;a href=&#34;#custom-domain-setup-finally-something-easy&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Custom Domain Setup (Finally, Something Easy)
&lt;/h3&gt;&lt;p&gt;The last piece was getting my custom domain working properly. This part was actually straightforward for once:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Added the domain in Cloudflare Pages under Custom Domains&lt;/li&gt;
&lt;li&gt;Set up DNS with a CNAME record pointing to the pages.dev URL&lt;/li&gt;
&lt;li&gt;Enabled proxy mode for better performance&lt;/li&gt;
&lt;li&gt;Set SSL to Full (Strict) because why not&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And it worked. First try. I was almost disappointed by how easy it was after everything else.&lt;/p&gt;
&lt;h3 id=&#34;what-i-actually-learned&#34;&gt;&lt;a href=&#34;#what-i-actually-learned&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;What I Actually Learned
&lt;/h3&gt;&lt;p&gt;The final workflow is genuinely nice:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I write posts in markdown and commit to my Gitea instance, push to GitHub, and Cloudflare automatically builds and deploys. Everything just works.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The main lessons from this adventure:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Git submodules are finicky but they do work&lt;/strong&gt; once you get them right&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Version pinning matters&lt;/strong&gt; - don&amp;rsquo;t assume the build environment has what you need&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sometimes starting over is faster&lt;/strong&gt; than trying to fix a broken git state&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Read error messages carefully&lt;/strong&gt; (I&amp;rsquo;m still working on this one)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;whats-next&#34;&gt;&lt;a href=&#34;#whats-next&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;What&amp;rsquo;s Next
&lt;/h3&gt;&lt;p&gt;I&amp;rsquo;m genuinely happy with how this turned out. The writing experience is smooth, deployment is automatic, and I don&amp;rsquo;t have to worry about keeping a CMS updated.&lt;/p&gt;
&lt;p&gt;I might add webhooks to automatically sync from Gitea to GitHub, just to remove that manual step. But honestly, the current setup works well enough that I&amp;rsquo;m not in a rush to complicate it further.&lt;/p&gt;
&lt;p&gt;Plus, now I actually have a place to write about all the other stuff I&amp;rsquo;ve been tinkering with. And more importantly, a place to get these thoughts out of my head and into the world - even if most people don&amp;rsquo;t read them.&lt;/p&gt;
&lt;p&gt;Mission accomplished, I guess.&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
